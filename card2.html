<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="./image/Misacaファビコン.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>モバイルMisaca</title>

  <style>
    body, html {
        overflow: hidden;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Hiragino Sans", "Noto Sans JP", Arial, sans-serif;
      background: #f1f1f1;
      color: #222;
    }

    .app {
      max-width: 420px;
      margin: 0 auto;
      background: #fff;
      min-height: 100vh;
      position: relative;
    }

    /* --- ヘッダー --- */
    .header {
      padding: 14px 16px;
      text-align: center;
      font-weight: 600;
      border-bottom: 1px solid #e5e5e5;
      background: #fff;
    }

    /* --- カードエリア（位置を固定するために共通化） --- */
    .card-container {
      padding-top: 20px;
    }

    .misaca-img {
      display: block;
      margin: 0 auto;
      text-align: center;
      /* カードの影を追加してWallet風に */
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      border-radius: 12px;
    }

    /* --- メイン画面の要素 --- */
    .main-content {
      display: block;
    }

    .balance {
      padding: 20px 16px 0;
      font-size: 14px;
      color: #555;
    }

    .balance .yen {
      font-size: 28px;
      font-weight: 700;
      color: #000;
      margin-top: 4px;
    }

    .charge-btn, .charge-btn2 {
        width: 90%;
        max-width: 350px;
        margin: 20px auto;
        display: block;
        padding: 12px 0;
        color: white;
        font-size: 16px;
        font-weight: 600;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .charge-btn { background-color: #4fa36a; }
    .charge-btn:hover { background-color: #3b8955; }
    .charge-btn2 { background-color: #5983b9; }
    .charge-btn2:hover { background-color: #3d6394; }

    /* --- 決済画面の要素 --- */
    #payment-content {
      display: none; /* 初期は非表示 */
      text-align: center;
      padding-top: 20px;
    }

    .payment-box {
      background: #fff;
      margin: 10px 16px;
      padding: 20px;
      border-radius: 12px;
      text-align: left;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .touch-area {
      margin-top: 50px;
      cursor: pointer;
    }

    .touch-icon {
      width: 70px;
      height: 70px;
      border: 3px solid #007aff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 15px;
    }

    .touch-icon::after {
      content: "";
      width: 25px;
      height: 40px;
      border: 2px solid #007aff;
      border-radius: 4px;
    }

    .touch-text {
      color: #888;
      font-size: 18px;
      text-align: center;
    }

    /* --- タブバー --- */
    .tabbar {
      display: flex;
      border-top: 1.5px solid #acacac;
      background: #f1f1f1;
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      padding-bottom: 5px;
      z-index: 100;
    }

    .tab { flex: 1; text-align: center; padding: 10px 0 6px; font-size: 12px; color: #666; }
    .tab.active { color: #4fa36a; font-weight: 600; }

    /* --- モーダル --- */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: none; justify-content: center; align-items: center;
      z-index: 1000;
    }
    .modal { background: #fff; width: 80%; max-width: 320px; border-radius: 12px; padding: 20px; text-align: center; }
    .amount-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .amount-btn { padding: 10px; border: 1px solid #ddd; background: #f9f9f9; border-radius: 6px; font-weight: bold; cursor: pointer; }
    .close-modal { margin-top: 15px; display: inline-block; color: #666; font-size: 14px; text-decoration: underline; cursor: pointer; }
  </style>
</head>
<body>

  <div class="app">
    <div class="header" id="header-text">モバイルMisaca</div>

    <div class="card-container">
      <img class="misaca-img" id="card-img" src="./image/Misaca.png" width="280px" alt="Misacaカード画像">
    </div>

    <div id="main-view" class="main-content">
      <div class="balance">
        チャージ残高
        <div class="yen" id="balance-display">¥0</div>
      </div>
      <button class="charge-btn" onclick="openModal()">入金（チャージ）</button>
      <button class="charge-btn2" onclick="showPayment()">使用する</button>
    </div>

    <div id="payment-view" style="display: none;">
      <div class="payment-box">
        <div style="color:#888; font-size:12px;">残高</div>
        <div class="yen" id="payment-balance" style="font-size:24px; font-weight:700;">¥0</div>
      </div>
      <div class="touch-area" onclick="executePayment()">
        <div class="touch-icon"></div>
        <div class="touch-text">リーダーにかざしてください</div>
      </div>
      <div style="margin-top: 30px; color: #007aff; cursor: pointer;" onclick="hidePayment()">キャンセル</div>
    </div>

    <div class="tabbar" id="bottom-tabbar">
      <div class="tab active">Misaca一覧</div>
      <div class="tab">特急券/急行券</div>
      <div class="tab">SF履歴</div>
      <div class="tab">チケット購入<br>Misaca管理</div>
    </div>
  </div>

  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div class="modal-title">チャージ金額を選択</div>
      <div class="amount-grid">
        <button class="amount-btn" onclick="addBalance(1000)">1,000円</button>
        <button class="amount-btn" onclick="addBalance(2000)">2,000円</button>
        <button class="amount-btn" onclick="addBalance(3000)">3,000円</button>
        <button class="amount-btn" onclick="addBalance(5000)">5,000円</button>
        <button class="amount-btn" onclick="addBalance(10000)">10,000円</button>
      </div>
      <div class="close-modal" onclick="closeModal()">キャンセル</div>
    </div>
  </div>

  <script>
    let currentBalance = 0;

    window.onload = function() {
      const savedBalance = localStorage.getItem('misaca_balance');
      if (savedBalance !== null) {
        currentBalance = parseInt(savedBalance, 10);
      } else {
        currentBalance = 10000;
        saveToStorage();
      }
      updateDisplay();
    };

    function updateDisplay() {
      const formatted = '¥' + currentBalance.toLocaleString();
      document.getElementById('balance-display').innerText = formatted;
      document.getElementById('payment-balance').innerText = formatted;
      saveToStorage();
    }

    function saveToStorage() {
      localStorage.setItem('misaca_balance', currentBalance);
    }

    // --- 画面切り替え ---
    function showPayment() {
      document.getElementById('main-view').style.display = 'none';
      document.getElementById('bottom-tabbar').style.display = 'none';
      document.getElementById('header-text').innerText = '支払い';
      document.getElementById('payment-view').style.display = 'block';
    }

    function hidePayment() {
      document.getElementById('main-view').style.display = 'block';
      document.getElementById('bottom-tabbar').style.display = 'flex';
      document.getElementById('header-text').innerText = 'モバイルMisaca';
      document.getElementById('payment-view').style.display = 'none';
    }

    // --- 決済実行 ---
    function executePayment() {
      const cost = 210; // 1回210円
      if (currentBalance < cost) {
        alert("残高が足りません");
        return;
      }
      
      // 決済音の代わりに少し待機
      setTimeout(() => {
        currentBalance -= cost;
        updateDisplay();
        alert("決済が完了しました。");
        hidePayment();
      }, 300);
    }

    // --- チャージ機能 ---
    function openModal() { document.getElementById('modalOverlay').style.display = 'flex'; }
    function closeModal() { document.getElementById('modalOverlay').style.display = 'none'; }
    function addBalance(amount) {
      currentBalance += amount;
      updateDisplay();
      closeModal();
      alert(amount.toLocaleString() + "円チャージしました。");
    }

    window.onclick = function(event) {
      if (event.target == document.getElementById('modalOverlay')) closeModal();
    };
  </script>

</body>
</html>